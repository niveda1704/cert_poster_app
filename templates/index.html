<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flamingo Studio | AI Design</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- 1. Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>

<body>
    <!-- 2. Custom Cursor Elements -->
    <div class="cursor-dot" data-cursor-dot></div>
    <div class="cursor-outline" data-cursor-outline></div>

    <div class="app-layout">
        <!-- Sidebar Controls -->
        <aside class="sidebar glass-panel">
            <header class="app-header">
                <div class="logo-area">
                    <img src="{{ url_for('static', filename='flamingo_logo.png') }}" alt="Flamingo Logo"
                        class="logo-icon" style="width: 42px; height: 42px;">
                    <h1>Flamingo <span class="badge"
                            style="background:var(--bg-app); color:var(--primary); border-color:var(--border-subtle);">Studio</span>
                    </h1>
                </div>
                <p class="subtitle">Design assets with a tropical touch.</p>
            </header>

            <div class="controls-wrapper">

                <div class="controls-wrapper">

                    <!-- NEW: Audience Selector -->
                    <div class="setting-group" style="margin-bottom: 1.5rem;">
                        <label class="section-label"><i data-lucide="users"></i> I am a...</label>
                        <select id="audience-select" class="custom-select">
                            <option value="student">Student</option>
                            <option value="designer">Designer</option>
                            <option value="manager">Event Manager</option>
                        </select>
                    </div>

                    <!-- 1. Mode Toggle -->
                    <div class="mode-toggle-container">
                        <div class="mode-toggle">
                            <button class="mode-btn active" data-mode="poster">
                                <i data-lucide="image"></i> Poster
                            </button>
                            <button class="mode-btn" data-mode="certificate">
                                <i data-lucide="file-check"></i> Certificate
                            </button>
                        </div>
                    </div>

                    <!-- 2. Dynamic Templates -->
                    <div class="templates-section">

                        <!-- Poster Templates -->
                        <div id="templates-poster" class="templates-grid">
                            <div class="template-card" data-template="tech_hackathon">
                                <div class="t-icon" style="background:#0f172a"><i data-lucide="cpu"></i></div>
                                <span>Hackathon</span>
                            </div>
                            <div class="template-card" data-template="music_concert">
                                <div class="t-icon" style="background:#be123c"><i data-lucide="music"></i></div>
                                <span>Concert</span>
                            </div>
                            <div class="template-card" data-template="workshop">
                                <div class="t-icon" style="background:#d97706"><i data-lucide="users"></i></div>
                                <span>Workshop</span>
                            </div>
                            <div class="template-card" data-template="sale">
                                <div class="t-icon" style="background:#16a34a"><i data-lucide="shopping-tag"></i></div>
                                <span>Sale</span>
                            </div>
                        </div>

                        <!-- Certificate Templates (Hidden by default) -->
                        <div id="templates-certificate" class="templates-grid hidden">
                            <div class="template-card" data-template="corp_award">
                                <div class="t-icon" style="background:#1e3a8a"><i data-lucide="award"></i></div>
                                <span>Award</span>
                            </div>
                            <div class="template-card" data-template="diploma">
                                <div class="t-icon" style="background:#7c3aed"><i data-lucide="scroll"></i></div>
                                <span>Diploma</span>
                            </div>
                            <div class="template-card" data-template="appreciation">
                                <div class="t-icon" style="background:#059669"><i data-lucide="heart-handshake"></i>
                                </div>
                                <span>Thanks</span>
                            </div>
                            <div class="template-card" data-template="participation">
                                <div class="t-icon" style="background:#db2777"><i data-lucide="medal"></i></div>
                                <span>Badge</span>
                            </div>
                        </div>
                    </div>

                    <div class="input-section">

                        <!-- NEW: Logo Upload (Ported) -->
                        <div class="setting-group" style="margin-bottom: 20px;">
                            <label class="section-label"><i data-lucide="image-plus"></i> Logo / Brand Asset</label>
                            <div class="file-drop-area custom-upload" id="logo-drop"
                                style="padding:15px; border-style:dashed;">
                                <input type="file" id="logo-file" accept=".png,.jpg,.jpeg,.svg" hidden>
                                <button class="upload-trigger" onclick="document.getElementById('logo-file').click()"
                                    style="width:100%">
                                    <i data-lucide="upload"></i> Upload Logo
                                </button>
                                <span class="file-name" id="logo-name" style="margin-top:8px; display:block;">Optional:
                                    Top Right (Default)</span>
                            </div>
                        </div>

                        <div class="input-section">
                            <label for="prompt" class="section-label">
                                <i data-lucide="message-square"></i> Describe your vision
                            </label>
                            <div class="textarea-wrapper">
                                <textarea id="prompt"
                                    placeholder="Describe your certificate or poster... e.g., 'Minimalist workshop completion certificate for Jane Doe in golden hues'"></textarea>
                                <button id="voice-btn" class="voice-trigger" title="Voice Input">
                                    <i data-lucide="mic"></i>
                                </button>
                            </div>
                        </div>

                        <!-- NEW: Live Prompt Coach -->
                        <div id="prompt-coach" class="coach-container hidden">
                            <div class="coach-header">
                                <span class="coach-score">Score: <span id="coach-score-val">0</span>/100</span>
                                <span class="coach-label">AI Coach</span>
                            </div>
                            <div class="progress-bar">
                                <div id="coach-progress" class="progress-fill" style="width: 0%"></div>
                            </div>
                            <ul id="coach-tips" class="coach-tips">
                                <!-- Tips injected here -->
                            </ul>
                        </div>

                        <!-- NEW: Audience Specific Tools -->
                        <div id="audience-tools" class="audience-tools-wrapper">

                            <!-- Student Tools -->
                            <div id="tools-student" class="tools-panel hidden">
                                <label class="sub-label">Student Essentials</label>
                                <div class="tool-row">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="print-safe-toggle">
                                        <span class="slider"></span>
                                    </label>
                                    <span>Print Safe (A4 Margins)</span>
                                </div>
                                <div class="warning-box hidden" id="plagiarism-warning">
                                    <i data-lucide="alert-triangle"></i> Sim: High similarity detected
                                </div>
                            </div>

                            <!-- Designer Tools -->
                            <div id="tools-designer" class="tools-panel hidden">
                                <label class="sub-label">Design Controls</label>
                                <div class="range-group">
                                    <label>Corner Radius</label>
                                    <input type="range" min="0" max="50" class="custom-range" id="radius-slider">
                                </div>
                                <div class="tool-row">
                                    <button class="tool-btn" id="grid-toggle"><i data-lucide="grid"></i> Grid</button>
                                    <button class="tool-btn" id="contrast-check"><i data-lucide="eye"></i>
                                        Contrast</button>
                                </div>
                            </div>

                            <!-- Manager Tools -->
                            <div id="tools-manager" class="tools-panel hidden">
                                <label class="sub-label">Event Readiness</label>
                                <div class="checklist">
                                    <label><input type="checkbox" id="check-brand"> Brand Locked</label>
                                    <label><input type="checkbox" id="check-venue"> Venue Confirmed</label>
                                    <label><input type="checkbox" id="check-sponsor"> Sponsors Added</label>
                                </div>
                            </div>
                        </div>

                        <!-- NEW: Prompt Remix -->
                        <div class="remix-section">
                            <label class="sub-label">Remix Prompt</label>
                            <div class="chip-row">
                                <button class="chip-btn" data-remix="formal">Formal</button>
                                <button class="chip-btn" data-remix="creative">Creative</button>
                                <button class="chip-btn" data-remix="festive">Festive</button>
                            </div>
                        </div>

                        <div class="setting-row">
                            <div class="setting-group">
                                <label class="section-label"><i data-lucide="languages"></i> Language</label>
                                <select id="language" class="custom-select">
                                    <option value="English">English</option>
                                    <option value="Tamil">Tamil</option>
                                    <option value="Hindi">Hindi</option>
                                    <option value="Spanish">Spanish</option>
                                    <option value="French">French</option>
                                    <option value="German">German</option>
                                </select>
                            </div>
                        </div>

                        <button id="generate-btn" class="generate-btn">
                            <span class="btn-text">Generate Assets</span>
                            <i data-lucide="wand-2"></i>
                        </button>

                        <div class="divider">
                            <span>OR</span>
                        </div>

                        <div class="bulk-upload-section">
                            <label class="section-label"><i data-lucide="upload-cloud"></i> Bulk Generation
                                (CSV)</label>
                            <div class="file-drop-area" id="drop-area">
                                <input type="file" id="csv-file" accept=".csv" hidden>
                                <button class="upload-trigger" onclick="document.getElementById('csv-file').click()">
                                    Choose CSV File
                                </button>
                                <span class="file-name" id="file-name">No file chosen</span>
                            </div>
                            <button id="bulk-btn" class="secondary-btn">Process Bulk</button>
                            <!-- NEW: CSV Preview for Managers -->
                            <div id="csv-preview" class="csv-preview hidden">
                                <small>Previewing 5 rows...</small>
                                <div class="csv-grid-mock"></div>
                            </div>
                        </div>
                    </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <div id="status-container" class="status-overlay hidden">
                <div class="loader-content">
                    <div class="spinner"></div>
                    <h2>Creating Magic...</h2>
                    <p id="status-text">Analyzing your request</p>
                </div>
            </div>

            <div class="results-grid">
                <!-- Poster Result (Added tilt-card class) -->
                <div class="result-card tile-card" id="poster-preview" data-tilt>
                    <div class="card-header">
                        <h3><i data-lucide="image"></i> Poster Design</h3>
                        <div class="actions hidden" id="poster-actions">
                            <a id="download-poster" href="#" download class="action-btn" title="Download PNG">
                                <i data-lucide="download"></i>
                            </a>
                        </div>
                    </div>
                    <div class="canvas-container">
                        <div class="empty-state">
                            <i data-lucide="layout-template"></i>
                            <p>Poster preview</p>
                        </div>
                        <img id="poster-img" src="" alt="Poster" class="result-img hidden">
                    </div>
                </div>

                <!-- Certificate Result (Added tilt-card class) -->
                <div class="result-card tile-card" id="cert-preview" data-tilt>
                    <div class="card-header">
                        <h3><i data-lucide="file-check"></i> Certificate Document</h3>
                        <div class="actions hidden" id="cert-actions">
                            <a id="download-cert" href="#" download class="action-btn" title="Download PDF">
                                <i data-lucide="download"></i>
                            </a>
                            <!-- NEW: Share Link -->
                            <button id="share-btn" class="action-btn" title="Share Design">
                                <i data-lucide="share-2"></i>
                            </button>
                        </div>
                    </div>
                    <div class="canvas-container pdf-container">
                        <div class="empty-state">
                            <i data-lucide="file-badge"></i>
                            <p>Certificate PDF</p>
                        </div>
                        <iframe id="cert-pdf" src="" class="result-iframe hidden"></iframe>
                    </div>
                </div>
            </div>
    </div>

    <!-- NEW: Explainability Panel -->
    <div class="explain-panel"
        style="margin-top: 3rem; background: rgba(255,255,255,0.6); padding: 2rem; border-radius: var(--radius-lg); border: 1px solid var(--border-subtle);">
        <h3 style="display:flex; align-items:center; gap:8px; font-size:1.1rem; margin-bottom:1rem;"><i
                data-lucide="sparkles"></i> AI Insights</h3>
        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem;">

            <div>
                <h4 style="font-size:0.9rem; color:var(--text-muted); margin-bottom:8px;">TEMPLATE SELECTED</h4>
                <div class="chip"
                    style="background:white; border:1px solid var(--border-subtle); padding:4px 10px; border-radius:6px; display:inline-block; font-size:0.8rem;">
                    <i data-lucide="layout"></i> <span id="explain-template">Custom / None</span>
                </div>
            </div>

            <div>
                <h4 style="font-size:0.9rem; color:var(--text-muted); margin-bottom:8px;">STYLE DECISIONS</h4>
                <ul style="list-style:none; font-size:0.85rem; color:var(--text-main); line-height:1.6;">
                    <li>• Palette: <b style="color:var(--primary)">Rose & Slate</b></li>
                    <li>• Typography: <b>Space Grotesk</b> (Headers)</li>
                    <li>• Composition: <b>Golden Ratio</b> enforced</li>
                </ul>
            </div>

            <div>
                <h4 style="font-size:0.9rem; color:var(--text-muted); margin-bottom:8px;">AI ENHANCEMENTS</h4>
                <p style="font-size:0.85rem; line-height:1.5;">
                    The AI automatically adjusted contrast for readability and added a "Glassmorphism" effect based on
                    current design trends.
                </p>
            </div>

        </div>
    </div>
    </main>
    </div>

    <!-- NEW: Flamingo Stage -->
    <div id="flamingo-stage"
        style="position:fixed; top:0; left:0; width:100vw; height:100vh; pointer-events:none; z-index:9999; overflow:hidden; display:none;">
    </div>

    <!-- NEW: Floating Camera Element -->
    <div class="floating-camera" title="Snap a mental picture!">
        <div class="camera-body">
            <div class="camera-lens">
                <div class="lens-reflection"></div>
            </div>
            <div class="camera-flash"></div>
            <div class="camera-shutter"></div>
        </div>
    </div>


    <!-- Init Icons -->
    <script>
        lucide.createIcons();

        document.getElementById('csv-file').addEventListener('change', function (e) {
            const fileName = e.target.files[0]?.name || 'No file chosen';
            document.getElementById('file-name').textContent = fileName;
        });
    </script>

    <!-- 3. Vanilla Tilt Library for 3D Cards -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.0/vanilla-tilt.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>

</html>